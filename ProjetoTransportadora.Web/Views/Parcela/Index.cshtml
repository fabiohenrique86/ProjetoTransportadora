@using ProjetoTransportadora.Dto;
@using ProjetoTransportadora.Dto;

@{
    ViewBag.Title = "Parcelas";

    UsuarioDto usuarioDto = null;
    if (Session[System.Configuration.ConfigurationManager.AppSettings["ProjetoTransportadora.Usuario"]] != null)
    {
        usuarioDto = (UsuarioDto)Session[System.Configuration.ConfigurationManager.AppSettings["ProjetoTransportadora.Usuario"]];
    }
}

@section styles
{
    <style type="text/css">
        .modal-lg {
            width: 85%;
        }

        .modal-md {
            width: 70%;
        }

        .modal-body {
            padding: 40px;
        }

        .ui-autocomplete {
            z-index: 2147483647;
        }
    </style>
}

@section scripts
{
    <script type="text/javascript">

        function calcularValorParcela() {

            var dataPagamento = $("#dataPagamento").val();

            var taxaMulta = Globalize.parseFloat($("#taxaMulta").val());
            if (isNaN(taxaMulta))
                taxaMulta = 0;

            var taxaMora = Globalize.parseFloat($("#taxaMora").val());
            if (isNaN(taxaMora))
                taxaMora = 0;

            var valorResiduo = Globalize.parseFloat($("#valorResiduo").val());
            if (isNaN(valorResiduo))
                valorResiduo = 0;

            var valorAcrescimo = Globalize.parseFloat($("#valorAcrescimo").val());
            if (isNaN(valorAcrescimo))
                valorAcrescimo = 0;

            var valorDescontoParcela = Globalize.parseFloat($("#valorDescontoParcela").val());
            if (isNaN(valorDescontoParcela))
                valorDescontoParcela = 0;

            $.ajax({
                dataType: "json",
                type: "POST",
                url: "/Parcela/Calcular",
                data: JSON.stringify({
                    idContrato: $("#lblContrato").text(),
                    idContratoParcela: $("#idContratoParcela").val(),
                    dataPagamento: dataPagamento,
                    taxaMulta: taxaMulta,
                    taxaMora: taxaMora,
                    valorResiduo: valorResiduo,
                    valorAcrescimo: valorAcrescimo,
                    valorDescontoParcela: valorDescontoParcela
                }),
                contentType: "application/json",
                success: function (data) {

                    if (!data.Sucesso) {
                        alert(data.Erro ? "danger" : "warning", data.Mensagem);
                        return;
                    }

                    $("#valorDescontoJuros").val(Globalize.format(data.Data.ValorDescontoJuros, "n2"));
                    $("#valorJuros").val(Globalize.format(data.Data.ValorJuros, "n2"));
                    $("#valorMulta").val(Globalize.format(data.Data.ValorMulta, "n2"));
                    $("#valorMora").val(Globalize.format(data.Data.ValorMora, "n2"));
                    $("#valorParcela").val(Globalize.format(data.Data.ValorParcela, "n2"));
                }
            });
        }

        function limparFormulario() {
            $("#frmContratoParcelaDetalhe").trigger("reset");
            $("#tbContratoParcelaHistorico").DataTable().clear().draw();
            $("#tbContratoParcelaResiduo").DataTable().clear().draw();
        }

        function carregarModalContratoParcela(idContratoParcela) {

            limparFormulario();

            $.ajax({
                dataType: "json",
                type: "GET",
                url: "/Parcela/Listar",
                data: { Id: idContratoParcela },
                contentType: "application/json",
                success: function (data) {

                    if (!data.Sucesso) {
                        alert(data.Erro ? "danger" : "warning", data.Mensagem);
                        return;
                    }

                    $("#lblContrato").text(data.Data[0].IdContrato);
                    $("#lblNumeroParcela").text(data.Data[0].NumeroParcela);
                    $("#idContratoParcela").val(idContratoParcela);

                    // aba - dados parcela

                    if (data.Data[0].DataPagamento != null)
                        $("#dataPagamento").val(moment(data.Data[0].DataPagamento).format("DD/MM/YYYY"));

                    $("#taxaMulta").val(Globalize.format(data.Data[0].TaxaMulta, "n2"));
                    $("#taxaMora").val(Globalize.format(data.Data[0].TaxaMora, "n2"));
                    $("#valorResiduo").val(Globalize.format(data.Data[0].ValorResiduo, "n2"));

                    $("#dataEmissao").val(moment(data.Data[0].DataEmissao).format("DD/MM/YYYY"));
                    $("#valorDescontoParcela").val(Globalize.format(data.Data[0].ValorDescontoParcela, "n2"));
                    $("#valorAcrescimo").val(Globalize.format(data.Data[0].ValorAcrescimo, "n2"));
                    $("#situacaoParcela").val(data.Data[0].IdSituacaoParcela);

                    $("#dataVencimento").val(moment(data.Data[0].DataVencimento).format("DD/MM/YYYY"));
                    $("#valorOriginal").val(Globalize.format(data.Data[0].ValorOriginal, "n2"));
                    $("#valorJuros").val(Globalize.format(data.Data[0].ValorJuros, "n2"));
                    $("#valorMulta").val(Globalize.format(data.Data[0].ValorMulta, "n2"));

                    $("#valorDescontoJuros").val(Globalize.format(data.Data[0].ValorDescontoJuros, "n2"));
                    $("#valorMora").val(Globalize.format(data.Data[0].ValorMora, "n2"));
                    $("#valorAmortizacao").val(Globalize.format(data.Data[0].ValorAmortizacao, "n2"));
                    $("#valorParcela").val(Globalize.format(data.Data[0].ValorParcela, "n2"));

                    // aba - histórico

                    $("#tbContratoParcelaHistorico").DataTable().clear().draw();
                    $(data.Data[0].ContratoParcelaHistoricoDto).each(function (i, o) {

                        $("#tbContratoParcelaHistorico").DataTable().rows.add([
                            {
                                "Id": o.Id,
                                "DataHistorico": "<input type='text' class='form-control data datepicker text-center dataHistorico' value='" + moment(o.DataHistorico).format("DD/MM/YYYY") + "' />",
                                "Descricao": "<textarea class='form-control descricaoHistorico' rows='3'>" + o.Descricao + "</textarea>",
                                "Acao": "<i class='glyphicon glyphicon-remove' title='Excluir' style='cursor: pointer'></i>"
                            }]).draw();
                    });

                    $("#tbContratoParcelaResiduo").DataTable().clear();

                    if (data.Data[0].UltimaParcela) {
                        $("#lblValorResiduo").text("Valor Resíduo Total a Ser Somado");
                        $("#divContratoParcelaResiduo").show();
                        $("#tbContratoParcelaResiduo").DataTable().rows.add(data.Data[0].ContratoParcelaResiduoDto).draw();
                    }
                    else {
                        $("#divContratoParcelaResiduo").hide();
                        $("#lblValorResiduo").text("Valor Resíduo");
                    }

                    if (data.Data[0].IdSituacaoParcela == '@SituacaoParcelaDto.EnumSituacaoParcela.Paga.GetHashCode()'
                        || data.Data[0].IdSituacaoParcela == '@SituacaoParcelaDto.EnumSituacaoParcela.Antecipado.GetHashCode()'
                        || data.Data[0].IdSituacaoParcela == '@SituacaoParcelaDto.EnumSituacaoParcela.Baixado.GetHashCode()') {
                        $("#dataPagamento").prop("disabled", "disabled");
                        $("#taxaMulta").prop("disabled", "disabled");
                        $("#taxaMora").prop("disabled", "disabled");
                        $("#valorResiduo").prop("disabled", "disabled");
                        $("#dataEmissao").prop("disabled", "disabled");
                        $("#valorDescontoParcela").prop("disabled", "disabled");
                        $("#valorAcrescimo").prop("disabled", "disabled");
                        $("#situacaoParcela").prop("disabled", "disabled");
                    }
                    else
                    {
                        $("#dataPagamento").removeProp("disabled");
                        $("#taxaMulta").removeProp("disabled");
                        $("#taxaMora").removeProp("disabled");
                        $("#dataEmissao").removeProp("disabled");
                        $("#valorDescontoParcela").removeProp("disabled");
                        $("#valorAcrescimo").removeProp("disabled");
                        $("#situacaoParcela").removeProp("disabled");

                        if (data.Data[0].UltimaParcela)
                            $("#valorResiduo").prop("disabled", "disabled");
                        else
                            $("#valorResiduo").removeProp("disabled");
                    }

                    $("#modalContratoParcelaDetalhe").modal('show');
                    $('#dadosParcela-tab').click();
                }
            });
        }

        $(document).ready(function () {

            var tbContratoParcela = $("#tbContratoParcela").DataTable({
                "ordering": false,
                "bFilter": false,
                "paging": false,
                "ordering": false,
                "info": false,
                "searching": false,
                "language": {
                    "lengthMenu": "_MENU_ registros por página",
                    "zeroRecords": "Sem registros a serem exibidos",
                    "info": "Página _PAGE_ de _PAGES_",
                    "infoEmpty": "Sem registros a serem exibidos",
                    "infoFiltered": "(filtrados de _MAX_ total de registros)",
                    "sSearch": "Pesquisar",
                    "oPaginate": { "sNext": "Próximo", "sPrevious": "Anterior", "sFirst": "Primeiro", "sLast": "Último" }
                },
                "columns":
                    [
                        { "data": "Id", "className": "text-center" },
                        { "data": "NumeroParcela", "className": "text-center" },
                        { "data": "NomeCliente", "className": "text-center" },
                        { "data": function (data, type, row) { return data["DataVencimento"] != null ? moment(data["DataVencimento"]).format("DD/MM/YYYY") : "" }, "className": "text-center" },
                        { "data": function (data, type, row) { return data["ValorParcela"] != null ? Globalize.format(data.ValorParcela, "n2") : "" }, "className": "text-center" },
                        { "data": "NomeSituacaoParcela", "className": "text-center" },
                        {
                            "data": function (data, type, row) {

                                var detalhes = "<i class='glyphicon glyphicon-menu-hamburger' title='Detalhes' style='cursor: pointer' onclick='carregarModalContratoParcela(" + data.IdContratoParcela + ")'></i>";
                                return detalhes;

                            }, "className": "text-center"
                        }
                    ],
                "footerCallback": function (row, data, start, end, display) {

                    var api = this.api();
                    var intVal = function (i) { return typeof i === 'string' ? parseFloat(i.replace(".", "").replace(",", ".")) : typeof i === 'number' ? i : 0; };

                    var valorParcelaTotal = api.column(4).data().reduce(function (a, b) { return intVal(a) + intVal(b); }, 0);

                    $(api.column(0).footer()).html('Total');
                    $(api.column(4).footer()).html(Globalize.format(valorParcelaTotal, "n2"));
                }
            });

            var tbContratoParcelaResiduo = $("#tbContratoParcelaResiduo").DataTable({
                "ordering": false,
                "bFilter": false,
                "paging": false,
                "ordering": false,
                "info": false,
                "searching": false,
                "language": {
                    "lengthMenu": "_MENU_ registros por página",
                    "zeroRecords": "Sem registros a serem exibidos",
                    "info": "Página _PAGE_ de _PAGES_",
                    "infoEmpty": "Sem registros a serem exibidos",
                    "infoFiltered": "(filtrados de _MAX_ total de registros)",
                    "sSearch": "Pesquisar",
                    "oPaginate": { "sNext": "Próximo", "sPrevious": "Anterior", "sFirst": "Primeiro", "sLast": "Último" }
                },
                "columns":
                    [
                        { "data": "NumeroParcela", "className": "text-center" },
                        { "data": function (data, type, row) { return data["DataVencimento"] != null ? moment(data["DataVencimento"]).format("DD/MM/YYYY") : "" }, "className": "text-center" },
                        { "data": function (data, type, row) { return data["ValorResiduo"] != null ? Globalize.format(data.ValorResiduo, "n2") : "" }, "className": "text-center" }
                    ],
                "footerCallback": function (row, data, start, end, display) {

                    var api = this.api();
                    var intVal = function (i) { return typeof i === 'string' ? parseFloat(i.replace(".", "").replace(",", ".")) : typeof i === 'number' ? i : 0; };

                    var valorResiduoTotal = api.column(2).data().reduce(function (a, b) { return intVal(a) + intVal(b); }, 0);

                    $(api.column(0).footer()).html('Total');
                    $(api.column(2).footer()).html(Globalize.format(valorResiduoTotal, "n2"));
                }
            });

            var tbContratoParcelaHistorico = $("#tbContratoParcelaHistorico").DataTable({
                "ordering": false,
                "bFilter": false,
                "paging": false,
                "ordering": false,
                "info": false,
                "searching": false,
                "autoWidth": false,
                "language": {
                    "lengthMenu": "_MENU_ registros por página",
                    "zeroRecords": "Sem registros a serem exibidos",
                    "info": "Página _PAGE_ de _PAGES_",
                    "infoEmpty": "Sem registros a serem exibidos",
                    "infoFiltered": "(filtrados de _MAX_ total de registros)",
                    "sSearch": "Pesquisar",
                    "oPaginate": { "sNext": "Próximo", "sPrevious": "Anterior", "sFirst": "Primeiro", "sLast": "Último" }
                },
                "columns":
                    [
                        { "data": "Id", "className": "text-center", "visible": false, "width": "5%" },
                        { "data": "DataHistorico", "className": "text-center", "width": "5%" },
                        { "data": "Descricao", "className": "text-center", "width": "85%" },
                        { "data": "Acao", "className": "text-center", "width": "5%" }
                    ]
            });

            // botão excluir tbContratoParcelaHistorico
            $('#tbContratoParcelaHistorico tbody').on('click', 'i.glyphicon-remove', function () {
                if (confirm("Deseja realmente excluir o histórico?")) {
                    tbContratoParcelaHistorico.row($(this).parents('tr')).remove().draw();
                }
            });

            $("#clientePesquisar").autocomplete({
                minLength: 3,
                source: function (request, response) {
                    var nome = null;
                    var cpf = null;
                    var cnpj = null;
                    var numero = parseInt(request.term);

                    if (isNaN(numero))
                        nome = request.term;
                    else {
                        cpf = request.term;
                        cnpj = request.term;
                    }

                    $.getJSON("/PessoaJuridica/ListarAutoComplete", { Nome: nome, Cpf: cpf, Cnpj: cnpj, Ativo: true }, function (data, status, xhr) {
                        // se não houver pessoa cadastrada, retorna mensagem ao usuário
                        if (data == null || data.Data.length <= 0) {
                            data.Data.push({ Id: 0, Nome: "Pessoa não cadastrada", Cpf: null, Cnpj: null });
                        }
                        response($.map(data.Data, function (pessoa) {
                            if (pessoa.Cpf == null && pessoa.Cnpj == null)
                                return { label: pessoa.Nome, value: pessoa.Id }
                            else if (pessoa.Cpf != null)
                                return { label: pessoa.Nome + " (" + formatarCpf(pessoa.Cpf) + ")", value: pessoa.Id }
                            else if (pessoa.Cnpj != null)
                                return { label: pessoa.Nome + " (" + formatarCnpj(pessoa.Cnpj) + ")", value: pessoa.Id }
                        }));
                    });
                },
                select: function (event, ui) {
                    // apaga a pesquisa do cliente selecionado
                    if (ui.item.label == "Pessoa não cadastrada") {
                        ui.item.label = "";
                        ui.item.value = "";
                        return;
                    }
                    $("#idClientePesquisar").val(ui.item.value);
                    ui.item.label = ui.item.label;
                    ui.item.value = ui.item.label;
                },
                change: function (event, ui)
                {
                    if (ui == null || ui.item == undefined || ui.item == null) {
                        $("#clientePesquisar").val("");
                        $("#idClientePesquisar").val("");
                    }
                }
            });

            $("#btnPesquisar").click(function () {

                var contratoDto = {};

                contratoDto.Id = $("#numeroContratoPesquisar").val();
                contratoDto.IdCliente = $("#idClientePesquisar").val();
                contratoDto.IdProduto = $("#produtoPesquisar").val();

                if ($("#placaPesquisar").val() != "")
                    contratoDto.VeiculoDto = { Placa: $("#placaPesquisar").val() };

                contratoDto.IdSituacaoContrato = $("#situacaoContratoPesquisar").val();
                contratoDto.DataContratoInicial = $("#dataContratoInicioPesquisar").val();
                contratoDto.DataContratoFinal = $("#dataContratoFimPesquisar").val();

                contratoDto.ContratoParcelaDto = [];
                contratoDto.ContratoParcelaDto.push({ "DataVencimentoInicio": $("#dataVencimentoInicioPesquisar").val(), "DataVencimentoFim": $("#dataVencimentoFimPesquisar").val(), "IdSituacaoParcela": $("#situacaoParcelaPesquisar").val() });

                $.ajax({
                    dataType: "json",
                    type: "POST",
                    url: "/Contrato/ListarGridParcela",
                    data: JSON.stringify(contratoDto),
                    contentType: "application/json",
                    success: function (data) {

                        if (!data.Sucesso) {
                            alert(data.Erro ? "danger" : "warning", data.Mensagem);
                            return;
                        }

                        tbContratoParcela.clear();
                        tbContratoParcela.rows.add(data.Data).draw();
                    }
                });

            });

            $("#btnAdicionarContratoParcelaHistorico").click(function () {

                tbContratoParcelaHistorico.rows.add([
                {
                    "Id": 0,
                    "DataHistorico": "<input type='text' class='form-control data datepicker text-center dataHistorico' />",
                    "Descricao": "<textarea class='form-control descricaoHistorico' rows='3'></textarea>",
                    "Acao": "<i class='glyphicon glyphicon-remove' title='Excluir' style='cursor: pointer'></i>"
                }]).draw();

                $(".dataHistorico").mask("00/00/0000");

                $(".dataHistorico").datepicker({
                    dateFormat: 'dd/mm/yy',
                    dayNames: ['Domingo', 'Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado'],
                    dayNamesMin: ['D', 'S', 'T', 'Q', 'Q', 'S', 'S', 'D'],
                    dayNamesShort: ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'],
                    monthNames: ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'],
                    monthNamesShort: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
                    nextText: 'Próximo',
                    prevText: 'Anterior',
                    changeMonth: true,
                    changeYear: true
                });
            });

            $("#btnAlterar").click(function () {

                var contratoParcelaDto = {};

                // aba - dados parcela

                contratoParcelaDto.Id = $("#idContratoParcela").val();

                contratoParcelaDto.DataPagamento = $("#dataPagamento").val();
                contratoParcelaDto.TaxaMulta = $("#taxaMulta").val().replace(".", ",");
                contratoParcelaDto.TaxaMora = $("#taxaMora").val().replace(".", ",");
                contratoParcelaDto.ValorResiduo = $("#valorResiduo").val();

                contratoParcelaDto.DataEmissao = $("#dataEmissao").val();
                contratoParcelaDto.ValorDescontoParcela = $("#valorDescontoParcela").val();
                contratoParcelaDto.ValorAcrescimo = $("#valorAcrescimo").val();
                contratoParcelaDto.IdSituacaoParcela = $("#situacaoParcela").val();

                contratoParcelaDto.DataVencimento = $("#dataVencimento").val();
                contratoParcelaDto.ValorOriginal = $("#valorOriginal").val();
                contratoParcelaDto.ValorJuros = $("#valorJuros").val();
                contratoParcelaDto.ValorMulta = $("#valorMulta").val();

                contratoParcelaDto.ValorDescontoJuros = $("#valorDescontoJuros").val();
                contratoParcelaDto.ValorMora = $("#valorMora").val();
                contratoParcelaDto.ValorAmortizacao = $("#valorAmortizacao").val();
                contratoParcelaDto.ValorParcela = $("#valorParcela").val();

                // aba - histórico

                contratoParcelaDto.ContratoParcelaHistoricoDto = [];
                tbContratoParcelaHistorico.rows().every(function (rowIdx, tableLoop, rowLoop)
                {
                    contratoParcelaDto.ContratoParcelaHistoricoDto.push
                        ({
                            "IdContratoParcela": contratoParcelaDto.Id,
                            "DataHistorico": $($($(".dataHistorico")[rowIdx]).parents("tr").children().eq(0)).children().val(),
                            "Descricao": $($($(".descricaoHistorico")[rowIdx]).parents("tr").children().eq(1)).children().val(),
                            "IdUsuarioCadastro": '@usuarioDto.Id',
                            "DataCadastro": '@DateTime.UtcNow'
                        });
                });

                $.ajax({
                    dataType: "json",
                    type: "POST",
                    url: "/Parcela/Alterar",
                    data: JSON.stringify(contratoParcelaDto),
                    contentType: "application/json",
                    success: function (data) {

                        if (!data.Sucesso) {
                            alert(data.Erro ? "danger" : "warning", data.Mensagem);
                            return;
                        }

                        limparFormulario();

                        var idx;
                        $("#tbContratoParcela").DataTable().rows().every(function (rowIdx, tableLoop, rowLoop) {
                            if (this.data().IdContratoParcela == contratoParcelaDto.Id) {
                                idx = rowIdx;
                                return;
                            }
                        });

                        tbContratoParcela.row(idx).invalidate().data(data.Data[0]).draw();
                        $("#modalContratoParcelaDetalhe").modal('hide');
                    }
                });

            });

            $("#btnExportarContratoParcela").click(function () {

                var existeRegistroGrid = false;

                tbContratoParcela.rows().every(function (rowIdx, tableLoop, rowLoop) {
                    existeRegistroGrid = true;
                    return;
                });

                if (!existeRegistroGrid) {
                    alert("warning", "Não há registros a serem exportados");
                    return;
                }

                window.location.href = "@Url.Action("Exportar", "Parcela")?Id=" + $("#numeroContratoPesquisar").val() + "&IdCliente=" + $("#idClientePesquisar").val() + "&IdProduto=" + $("#produtoPesquisar").val() + "&VeiculoDto.Placa=" + $("#placaPesquisar").val() + "&IdSituacaoContrato=" + $("#situacaoContratoPesquisar").val() + "&DataContratoInicial=" + formatarData($("#dataContratoInicioPesquisar").val()) + "&DataContratoFinal=" + formatarData($("#dataContratoFimPesquisar").val()) + "&ContratoParcelaDto[0].DataVencimentoInicio=" + formatarData($("#dataVencimentoInicioPesquisar").val()) + "&ContratoParcelaDto[0].DataVencimentoFim=" + formatarData($("#dataVencimentoFimPesquisar").val()) + "&ContratoParcelaDto[0].IdSituacaoParcela=" + $("#situacaoParcelaPesquisar").val();
            });

        });

    </script>
}
<div>
    <h2><i class="glyphicon glyphicon-signal" style="color: #0f3456" title="Parcelas"></i> Parcelas</h2>
    <hr />
    <input id="idContrato" type="hidden" />
    <div class="form-group">
        <div class="row">
            <div class="col-md-3">
                <label for="numeroContratoPesquisar">Número Contrato:</label>
                <input id="numeroContratoPesquisar" type="text" class="form-control" />
            </div>
            <div class="col-md-3">
                <label for="clientePesquisar">Cliente:</label>
                <input id="clientePesquisar" type="text" class="form-control" placeholder="Cliente (Mínimo de 3 caracteres - CPF ou CNPJ ou Nome)" />
                <input id="idClientePesquisar" type="hidden" />
            </div>
            <div class="col-md-3">
                <label for="placaPesquisar">Placa:</label>
                <input id="placaPesquisar" type="text" class="form-control" />
            </div>
            <div class="col-md-3">
                <label for="produtoPesquisar">Produto:</label>
                @Html.DropDownList("produtoPesquisar", new SelectList(ViewBag.Produto, "Id", "Nome"), "Selecione", new { @class = "form-control" })
            </div>
        </div>
    </div>
    <div class="form-group">
        <div class="row">
            <div class="col-md-3">
                <label for="situacaoContratoPesquisar">Situação Contrato:</label>
                @Html.DropDownList("situacaoContratoPesquisar", new SelectList(ViewBag.SituacaoContrato, "Id", "Nome"), "Selecione", new { @class = "form-control" })
            </div>
            <div class="col-md-3">
                <label for="situacaoParcelaPesquisar">Situação Parcela:</label>
                @Html.DropDownList("situacaoParcelaPesquisar", new SelectList(ViewBag.SituacaoParcela, "Id", "Nome"), "Selecione", new { @class = "form-control" })
            </div>
        </div>
    </div>
    <div class="form-group">
        <div class="row">
            <div class="col-md-3">
                <label>Data Contrato Início:</label>
                <input id="dataContratoInicioPesquisar" type="text" class="form-control data datepicker" />
            </div>
            <div class="col-md-3">
                <label>Data Contrato Fim:</label>
                <input id="dataContratoFimPesquisar" type="text" class="form-control data datepicker" />
            </div>
            <div class="col-md-3">
                <label>Data Vencimento Início:</label>
                <input id="dataVencimentoInicioPesquisar" type="text" class="form-control data datepicker" />
            </div>
            <div class="col-md-3">
                <label>Data Vencimento Fim:</label>
                <input id="dataVencimentoFimPesquisar" type="text" class="form-control data datepicker" />
            </div>
        </div>
    </div>
    <div class="form-group">
        <div class="row">
            <div class="col-md-3">
                <input id="btnPesquisar" type="button" class="btn btn-info" value="Pesquisar" />
            </div>
        </div>
    </div>
    <div class="form-group">
        <div class="row">
            <div class="col-md-12">
                <input id="btnExportarContratoParcela" type="button" class="btn btn-success" value="Exportar" />
            </div>
        </div>
    </div>
    <div class="form-group">
        <div class="table-responsive" style="overflow-x: scroll; overflow-y: scroll; height: 350px">
            <table id="tbContratoParcela" class="table table-hover nowrap" style="width: 100%">
                <thead>
                    <tr>
                        <td class="text-center"><b>Número Contrato</b></td>
                        <td class="text-center"><b>Número Parcela</b></td>
                        <td class="text-center"><b>Nome Cliente</b></td>
                        <td class="text-center"><b>Data Vencimento</b></td>
                        <td class="text-center"><b>Valor Parcela</b></td>
                        <td class="text-center"><b>Situação Parcela</b></td>
                        <td class="text-center"><b>Ação</b></td>
                    </tr>
                </thead>
                <tbody></tbody>
                <tfoot align="left">
                    <tr>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
</div>

<div class="modal fade" id="modalContratoParcelaDetalhe" tabindex="-1" role="dialog" aria-labelledby="ModalContratoParcelaDetalhe" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Fechar</span></button>
                <h4 class="modal-title" id="myModalLabel"><span id="lblAcao"></span> Contrato <label id="lblContrato"></label> Parcela <label id="lblNumeroParcela"></label></h4>
            </div>
            <div class="modal-body">
                <form id="frmContratoParcelaDetalhe" action="#">
                    <input id="idContratoParcela" type="hidden" />
                    <div class="form-group">
                        <div class="row">
                            <ul id="myTab" class="nav nav-tabs nav-justified" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" id="dadosParcela-tab" data-toggle="tab" href="#dadosParcela" role="tab" aria-controls="dadosParcela" aria-selected="true">Dados da Parcela</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="historico-tab" data-toggle="tab" href="#historico" role="tab" aria-controls="historico" aria-selected="false">Histórico</a>
                                </li>
                            </ul>
                            <div class="tab-content">
                                <br />
                                <div class="tab-pane active" id="dadosParcela" role="tabpanel" aria-labelledby="dadosParcela-tab">
                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <label>Data Pagamento:</label>
                                                <input id="dataPagamento" type="text" class="form-control data datepicker" onchange="calcularValorParcela()" />
                                            </div>
                                            <div class="col-md-3">
                                                <label>Taxa Multa:</label>
                                                <input id="taxaMulta" type="text" class="form-control" onchange="calcularValorParcela()" />
                                            </div>
                                            <div class="col-md-3">
                                                <label>Taxa Mora (a.m):</label>
                                                <input id="taxaMora" type="text" class="form-control" onchange="calcularValorParcela()" />
                                            </div>
                                            <div class="col-md-3">
                                                <label id="lblValorResiduo">Valor Resíduo:</label>
                                                <input id="valorResiduo" type="text" class="form-control valor" onchange="calcularValorParcela()" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <label>Data Emissão:</label>
                                                <input id="dataEmissao" type="text" class="form-control data datepicker" />
                                            </div>
                                            <div class="col-md-3">
                                                <label>Valor Desconto Parcela:</label>
                                                <input id="valorDescontoParcela" type="text" class="form-control valor" onchange="calcularValorParcela()" />
                                            </div>
                                            <div class="col-md-3">
                                                <label>Valor Acréscimo:</label>
                                                <input id="valorAcrescimo" type="text" class="form-control valor" onchange="calcularValorParcela()" />
                                            </div>
                                            <div class="col-md-3">
                                                <label>Situação Parcela:</label>
                                                @Html.DropDownList("situacaoParcela", new SelectList(ViewBag.SituacaoParcela, "Id", "Nome"), "Selecione", new { @class = "form-control" })
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <label>Data Vencimento:</label>
                                                <input id="dataVencimento" type="text" class="form-control" disabled="disabled" />
                                            </div>
                                            <div class="col-md-3">
                                                <label>Valor Original:</label>
                                                <input id="valorOriginal" type="text" class="form-control" disabled="disabled" />
                                            </div>
                                            <div class="col-md-3">
                                                <label>Valor Juros:</label>
                                                <input id="valorJuros" type="text" class="form-control" disabled="disabled" />
                                            </div>
                                            <div class="col-md-3">
                                                <label>Valor Multa:</label>
                                                <input id="valorMulta" type="text" class="form-control" disabled="disabled" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <label>Valor Desconto Juros:</label>
                                                <input id="valorDescontoJuros" type="text" class="form-control valor" disabled="disabled" />
                                            </div>
                                            <div class="col-md-3">
                                                <label>Valor Mora:</label>
                                                <input id="valorMora" type="text" class="form-control" disabled="disabled" />
                                            </div>
                                            <div class="col-md-3">
                                                <label>Valor Amortização:</label>
                                                <input id="valorAmortizacao" type="text" class="form-control" disabled="disabled" />
                                            </div>
                                            <div class="col-md-3">
                                                <label>Valor Parcela:</label>
                                                <input id="valorParcela" type="text" class="form-control" disabled="disabled" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane" id="historico" role="tabpanel" aria-labelledby="historico-tab">
                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-md-12 text-right">
                                                <input id="btnAdicionarContratoParcelaHistorico" type="button" class="btn" value="Adicionar Histórico" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="table-responsive">
                                            <table id="tbContratoParcelaHistorico" class="table nowrap" style="width: 100%">
                                                <thead>
                                                    <tr>
                                                        <td class="text-center"><b>Id</b></td>
                                                        <td class="text-center"><b>Data Histórico</b></td>
                                                        <td class="text-center"><b>Descrição</b></td>
                                                        <td class="text-center"><b>Ação</b></td>
                                                    </tr>
                                                </thead>
                                                <tbody></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="divContratoParcelaResiduo" class="form-group">
                        <div class="row">
                            <ul id="myTab2" class="nav nav-tabs nav-justified" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" id="residuos-tab" data-toggle="tab" href="#residuos" role="tab" aria-controls="residuos" aria-selected="true">Resíduos</a>
                                </li>
                            </ul>
                            <div class="tab-content">
                                <br />
                                <div class="tab-pane active" id="residuos" role="tabpanel" aria-labelledby="residuos-tab">
                                    <div class="form-group">
                                        <div class="table-responsive">
                                            <table id="tbContratoParcelaResiduo" class="table nowrap" style="width: 100%">
                                                <thead>
                                                    <tr>
                                                        <td class="text-center"><b>Número Parcela</b></td>
                                                        <td class="text-center"><b>Data Vencimento</b></td>
                                                        <td class="text-center"><b>Valor Resíduo</b></td>
                                                    </tr>
                                                </thead>
                                                <tbody></tbody>
                                                <tfoot align="left">
                                                    <tr>
                                                        <th></th>
                                                        <th></th>
                                                        <th></th>
                                                    </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <input id="btnAlterar" type="button" class="btn btn-warning" value="Alterar" />
            </div>
        </div>
    </div>
</div>